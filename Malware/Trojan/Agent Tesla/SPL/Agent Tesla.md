
[T1010] Suspicious Process Enumeration via Get-Process and mainWindowTitle
```
`indextime` `sysmon` <SEARCHSTRING>
| eval hash_sha256=lower(hash_sha256),
    hunting_trigger="INFOSTEALER - T1010 - Analytic 1 - Suspicious Process Enumeration",
    mitre_category="Discovery",
    mitre_technique="Application Window Discovery",
    mitre_technique_id="T1010",
    mitre_subtechnique="",
    mitre_subtechnique_id="",
    apt="",
    mitre_link="https://attack.mitre.org/techniques/T1010/",
    creator="Cpl Iverson",
    last_tested="",
    upload_date="2025-03-16",
    last_modify_date="2025-03-16",
    mitre_version="v16",
    priority="Medium",
    custom_category="infostealer"
| eval indextime = _indextime
| convert ctime(indextime)
| table _time indextime event_description hash_sha256 host_fqdn user_name original_file_name process_path process_guid process_parent_path process_id process_parent_id process_command_line process_parent_command_line process_parent_guid mitre_category mitre_technique mitre_technique_id hunting_trigger mitre_subtechnique mitre_subtechnique_id apt mitre_link last_tested creator upload_date last_modify_date mitre_version priority custom_category
| collect `jarvis_index`
```

A) Initial access & loaders (CHM ➜ PowerShell; Office ➜ dropper)
T1566.001 / T1218.001 / T1059.001 / T1204.002
```
index=win* (EventCode=4688 OR EventCode=1)
ParentImage="*\\hh.exe" (process_name="*\\powershell.exe" OR Image="*\\powershell.exe")
(CommandLine="*DownloadString*" OR CommandLine="*System.Net.WebClient*" OR CommandLine="*-enc*" OR CommandLine="*-windowstyle hidden*" )
| stats min(_time) as firstSeen max(_time) as lastSeen count by host user ParentImage Image CommandLine
| where count>=1
```

Office spawning suspicious EXE from Temp/AppData (generic AgentTesla dropper):

```
index=win* (EventCode=4688 OR EventCode=1)
(ParentImage="*\\WINWORD.EXE" OR ParentImage="*\\EXCEL.EXE" OR ParentImage="*\\POWERPNT.EXE" OR ParentImage="*\\OUTLOOK.EXE")
(Image="*.exe" OR NewProcessName="*.exe")
( CommandLine="*\\AppData\\Local\\Temp\\*" OR CommandLine="*\\Users\\*\\AppData\\Local\\Temp\\*" )
| table _time host user ParentImage Image CommandLine
```

Office or chrome generating cmd and powershell prompts except for McAfee
```SPL
`sysmon` EventCode=1 ParentImage IN (
    "*WINWORD.EXE"
    "*POWERPNT.EXE"
    "*OUTLOOK.EXE"
    "*EXCEL.EXE"
    "*CHROME.EXE"
    "*MSEDGE.EXE"
    "*FIREFOX.EXE"
) AND OriginalFileName IN (
    "cmd.exe"
    "powershell.exe"
) NOT CurrentDirectory IN (
    "C:\\Program Files\\McAfee\\DLP\\Agent\\"
)
| table _time host User ParentImage Image CommandLine
```

Persistence via Run keys / Startup folder
T1547.001 / T1112
```
index=win* (EventCode=12 OR EventCode=13)
TargetObject="*\\Software\\Microsoft\\Windows\\CurrentVersion\\Run*" 
| eval exe=coalesce(Image, ProcessImage)
| search Details="*\\AppData\\*" OR Details="*\\Users\\*\\AppData\\*"
| table _time host user TargetObject Details exe
```

Browser credential & cookie theft
T1555.003 / T1555 / T1185
```
```
